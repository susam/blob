(function(){var e=function(t,n,s){var r=Drupal.settings.username;if(s&&r||!s){return $.ajax({dataType:t["dataType"]?t["dataType"]:"JSON",url:t["url"],headers:{"x-csrf-token":window.csrfToken},type:t["type"]?t["type"]:"GET",data:t["data"],retryCount:t["retryCount"]?t["retryCount"]:0,retryLimit:5,success:function(e){if(e.status==="rate_limit_exceeded"){window.location.reload()}else if(typeof t["success"]=="function"){t["success"](e)}},error:function(r){if(r.status==403){values=$.parseJSON(r.responseText);if(values.status=="apierror"){window.location.reload()}}if(r.status>500&&this.retryCount<this.retryLimit){t["retryCount"]=t["retryCount"]?t["retryCount"]+1:1;setTimeout(function(){e(t,n,s)},2e3)}else{if(typeof t["error"]=="function"){t["error"](r)}}}})}};CCRanks=Ember.Application.createWithMixins(Bootstrap,{rootElement:"#ember_root"});var t={bg:"#2176e6",id:"mynano"};CCRanks.Router.map(function(){this.resource("rankings",{path:"/:contest_code/"})});CCRanks.Router.reopen({rootURL:"/rankings/",location:"history"});CCRanks.IndexRoute=Ember.Route.extend({renderTemplate:function(){this.render("info")}});Ember.DataTableRowView.reopen({getTemplateName:function(){if(!Ember.isEmpty(Drupal.settings.currentUser)){var e=this.get("context.user_handle");if(e==Drupal.settings.currentUser.trim()){this.set("classNames",["me"]);this.set("context.me","me")}}return this._super()}.property("rowTemplate")});CCRanks.ACMRankingMixin=Ember.Mixin.create({rowTemplate:"rowTemplateACM",staticProperties:["rank","user_handle","country","institution","institution_type","score","penalty","total_time","user_gender"],nonSortableProperties:["total_time"]});CCRanks.IOIRankingMixin=Ember.Mixin.create({rowTemplate:"rowTemplateIOI",staticProperties:["rank","user_handle","country","institution","institution_type","score","user_gender"]});CCRanks.ScoreBasedRankingMixin=Ember.Mixin.create({rowTemplate:"rowTemplateLONG",staticProperties:["rank","user_handle","country","institution","institution_type","score","penalty","user_gender"]});CCRanks.RankingType=Ember.A([{type:"ACM Style Ranklist",mixin:"ACMRankingMixin"},{type:"ACM Style Ranklist",mixin:"ACMRankingMixin"},{type:"IOI Style Ranklist",mixin:"IOIRankingMixin"},{type:"Score Based Ranklist",mixin:"ScoreBasedRankingMixin"}]);CCRanks.RankingsRoute=Ember.Route.extend({setupController:function(e,n){e.set("contest_code",n.contest_code);e.set("ajaxUrl","/api/rankings/"+n.contest_code);if(typeof e.get("sortBy")==="function"){e.set("sortBy","rank");e.set("order","asc")}CCRanks.nanobar=new Nanobar(t)}});CCRanks.RankingsController=Ember.ArrayController.extend(Ember.DataTableMixin,{isAjaxified:true,cacheMap:Ember.Map.create(),init:function(){this._super();this.timeObserver();this.timer()},userName:"",queryParams:["sortBy","order","search","page","itemsPerPage","filterBy","type"],filters:["institution","institution_type","user_gender"],filterPlaceHolders:Ember.Object.create({country:"e.g. India",institution:"e.g. Indian Institute of Technology, Bombay",institution_type:"e.g. School, College, Organization",user_gender:"e.g Female",set:"e.g. One of your set's name"}),rowTemplate:"rowTemplateACM",itemsPerPage:25,perPageSelector:[25,50,100],filterable:true,searchable:true,sortProperties:["rank"],staticProperties:["rank","user_handle","country","institution","institution_type","score","penalty","total_time","user_gender"],hidden:["country","institution","institution_type","penalty","user_gender"],headerAlias:Ember.Object.create({rank:"#",user_handle:"User Name",score:"Score",penalty:"Penalty",total_time:"Total Penalty"}),autodataQparams:{institution:"institution",country:"country",institution_type:"institution_type",user_gender:"user_gender"},queryParamsEnabled:true,contestPageUrl:function(){return"/"+this.get("contest_code")}.property("contest_code"),fbLikeUrl:function(){return Drupal.settings.baseURL+"/rankings/"+this.get("contest_code")}.property("contest_code"),properties:function(){var e=[];var t=this.get("problems");var n=this.get("staticProperties");var s=this.get("contest_info");if(Ember.isEmpty(s)||Ember.isEmpty(n)||Ember.isEmpty(t)){return[]}$.each(n,function(t,n){e.push(n)});$.each(t,function(t,n){e.push(n.code)});return e}.property("contest_info","problems","staticProperties"),propertiesToSearch:function(){return this.get("staticProperties")}.property("staticProperties"),ranking_type:function(){if(Ember.isEmpty(this.get("contest_info")))return"";return CCRanks.RankingType[this.get("contest_info").get("ranking_type")].type}.property("contest_info.ranking_type"),ranking_type_href:function(){if(Ember.isEmpty(this.get("contest_info")))return"";return"/rankings#"+CCRanks.RankingType[this.get("contest_info").get("ranking_type")].type.replace(/\s/g,"")}.property("contest_info.ranking_type"),autodata:function(){var e=this.get("filterName");if(Ember.isEmpty(e))return;var t=Ember.A();if(e=="Set"){this.get("sets").forEach(function(e){t.push({text:e.get("set_name")})})}else{t=this._super()}return t}.property("filterName","filters_autodata"),userNameObserver:function(){var e=this.get("userName");if(e.length>0){Ember.A(this.get("filters")).pushObject("set")}}.observes("userName"),isTeamBasedObserver:function(){var e=this.get("contest_info");if(!Ember.isEmpty(e)){Ember.A(this.get("filters"));this.get("filters").pushObject("country");if(e.is_team_based){this.set("isTeamBased",true)}}}.observes("contest_info"),timeObserver:function(){var e=this.get("contest_info");if(this.get("isContestEnded")){this.set("timeElapsed","");return}if(!Drupal.settings.isManager&&!Ember.isEmpty(e)&&e.is_ranklist_frozen){this.set("showRefresh",false)}else{this.set("timeElapsed","Ranklist fetched "+moment(this.get("generated")).fromNow()+".")}Em.run.later(this,this.timeObserver,5e3)},timer:function(){var e=this.get("contest_info");if(!Ember.isEmpty(e)){if(!navigator.onLine){showInternetError()}var t=e.time;var n=parseInt(moment()/1e3);var s=t.offset;var r=t.end+s;var i=t.start+s;var a=t.freezing+s;var o=function(e){t=[];var n=parseInt(e.asDays());t.push(n?n+" days":"");var s=e.hours();t.push(s?s+" hrs":"");var r=e.minutes();t.push(r?r+" mins":"");var i=e.seconds();t.push(i?i+" sec":"");return t.join(" ")};var c="";var u="";if(r-n<0){this.set("contestTimeElapsed","Contest Ended");this.set("isContestEnded",true);this.set("isContestRunning",false);this.set("showRefresh",false);this.set("timeElapsed","")}else if(r-n>0&&n-i>0){var l=this.get("isContestRunning");if(!l){this.set("didContestStart",true)}this.set("isContestRunning",true);this.set("showRefresh",true);u=moment.duration((r-n)*1e3);c=o(u);this.set("contestTimeElapsed","Contest Ends In: "+c)}else if(r-n>0&&i-n>0){this.set("isContestRunning",false);u=moment.duration((i-n)*1e3);c=o(u);this.set("contestTimeElapsed","Contest Starts In: "+c);this.set("showRefresh",false)}if(!Drupal.settings.isManager){if(e.is_ranklist_frozen){this.set("showRefresh",false);this.set("timeElapsed","Ranklist froze "+o(moment.duration((n-a)*1e3))+" ago")}}}Em.run.later(this,this.timer,1e3)},filterBySet:function(e,t){var n=Ember.A();var s=this.get("sets").filterBy("set_name",e).get(0);var r=s.get("members");t.forEach(function(e){var t=e.get("user_handle");var s=r.filterBy("member_name",t).get(0);if(!Ember.isEmpty(s)){n.pushObject(e)}});return n},fetchRanks:function(){this.notifyPropertyChange("queryStringChanged")},actions:{download:function(){var e="downloaded";var t="/api/rankings/";var n="download";var s="";o(e,t,n,s,this)},combinedDownload:function(){var e="combined_downloaded";var t="/api/combined_rankings/";var n="combined-download";var s="-combined";o(e,t,n,s,this)},refresh:function(){var e=this;var t=(Date.now()-this.get("generated"))/1e3;if(t<CCRanks.refreshTime){this.set("timeElapsed","Just Refreshed. Please try after "+Math.ceil(CCRanks.refreshTime-t)+" second(s).");return}this.set("timeElapsed","Fetching Ranklist.");if(this.get("userName")){this.store.find("set").then(function(){e.fetchRanks()},function(){i("Some Error Occurred.")})}else{e.fetchRanks()}},findMe:function(){if(this.get("page_me")==-1){i("Oops! couldn't find you.");return}this.set("isFindMeCall",true);if(this.get("page")==this.get("page_me")){this.checkFindMe()}this.set("page",this.get("page_me"))}},setTableEmptyMessage:function(e){if(!Ember.isEmpty(e.errorMessage)){this.set("tableEmptyMessage",e.errorMessage)}else{this.set("tableEmptyMessage","No results found with matching criteria.")}},setParticipationData:function(e){this.set("participated",!Ember.isEmpty(e)&&!Ember.isEmpty(e.rank_and_score)&&e.rank_and_score.rank!="NA");if(!Ember.isEmpty(e)&&!Ember.isEmpty(e.rank_and_score)){this.set("myScore",e.rank_and_score.score);this.set("myRank",e.rank_and_score.rank)}},setRequiredProperties:function(e){var t=this;try{e.contest_info.time.offset=parseInt(e.generated/1e3)-e.contest_info.time.current;if(Ember.isEmpty(t.get("contest_info"))){t.set("contest_info",Ember.Object.create(e.contest_info));var n=t.get("contest_info").ranking_type;t.set("problems",e.problems);t.reopen(CCRanks.get(CCRanks.RankingType[n].mixin));if(t.get("isTeamBased")){var s=this.get("staticProperties");s[1]="name";var r=this.get("headerAlias");delete r.user_handle;r["name"]="Name"}}t.set("filters_autodata",e.filters_autodata);t.set("availablePages",e.availablePages);t.set("totalItems",e.totalItems);t.set("selectedItems",e.selectedItems);t.set("page_me",e.page_me);t.set("generated",e.generated);t.setTableEmptyMessage(e);t.setParticipationData(e);CCRanks.refreshTime=e.refreshTime;t.timeObserver();t.timer()}catch(e){console.log(e)}},queryStringObserver:function(){CCRanks.nanobar.go(a(1,10));this.set("loading",true);var t=this;var n=this.get("cacheMap");var s=this.get("queryString");CCRanks.nanobar.go(a(10,15));var r=Em.A();CCRanks.nanobar.go(a(15,20));if(!Ember.isEmpty(s)){s="?"+s}CCRanks.nanobar.go(a(20,30));if(!n.has(s)||(Date.now()-n.get(s).generated)/1e3>=CCRanks.refreshTime){if(Ember.isEmpty(Drupal.settings.currentUser)){Drupal.settings.currentUser="";this.set("userName","")}else{this.set("userName",Drupal.settings.currentUser);this.store.find("set").then(function(e){t.set("sets",e.get("content"))},function(){i("Some Error Occurred")})}CCRanks.nanobar.go(a(30,60));var o=function(e){CCRanks.nanobar.go(a(60,70));try{e.generated=Date.now();t.setRequiredProperties(e);CCRanks.RankingItem.problems=e.problems;CCRanks.RankingItem.unscoredProblems=e.contest_info.unscored_problems;var i=e.list.length;var o=parseFloat(10/i);var c=70;e.list.forEach(function(t){t.isTeamBased=e.contest_info.is_team_based;t.contestCode=e.contest_info.contest_code;var n=CCRanks.RankingItem.create(t);n.sanitizeData();r.addObject(n);CCRanks.nanobar.go(c);c+=o});e.list=r;t.set("list",r);CCRanks.nanobar.go(a(80,90));n.set(s,e);t.checkFindMe();CCRanks.nanobar.go(100);t.set("loading",false)}catch(e){console.log(e.stack)}};var c={url:this.get("ajaxUrl")+s,success:o};e(c,false,false)}else{CCRanks.nanobar.go(a(30,40));var u=n.get(s);CCRanks.nanobar.go(a(40,70));this.setRequiredProperties(u);r=u.list;t.set("list",r);CCRanks.nanobar.go(a(70,90));t.checkFindMe();CCRanks.nanobar.go(100);t.set("loading",false)}return r}.observes("queryStringChanged"),checkFindMe:function(){var e=this;if(e.get("isFindMeCall")){Ember.run.scheduleOnce("afterRender",this,function(){var e=$("#me").offset();$("html, body").animate({scrollTop:e.top-160},"slow");s("Caught ya!")})}else{e.scrollTop()}e.set("isFindMeCall",false)},convertToCSV:function(e){var t=typeof e!="object"?JSON.parse(e):e;var n="";for(var s=0;s<t.length;s++){var r="";for(var i in t[s]){if(r!="")r+=",";r+='"'+t[s][i]+'"'}n+=r+"\r\n"}return n},scrollTop:function(){var e=$($(".cc_headings")[0]).offset();$("html, body").animate({scrollTop:e.top},"slow")}});CCRanks.RankingItem=Ember.Object.extend({profile_link:function(){return"/users/"+this.get("user_handle")}.property("user_handle"),display_name:function(){if(this.isTeamBased){return this.name}else{return this.html_handle}}.property("isTeamBased","html_handle","name"),display_title:function(){if(this.isTeamBased){return this.user_handle}else{return this.name}}.property("isTeamBased","user_handle","name"),flag_url:function(){if(Em.isEmpty(this.get("country_code"))){return"https://cdn.codechef.com/download/flags/24/_world.png"}return"https://cdn.codechef.com/download/flags/24/"+this.get("country_code").toLowerCase()+".png"}.property("country"),sanitizeData:function(){var e=CCRanks.RankingItem.problems;var t=CCRanks.RankingItem.unscoredProblems;var n=this.get("problems_status");var s=Ember.A();var r=this;$.each(e,function(e,i){var a;if(n==null||Ember.isEmpty(n[i.code])){a={score:0}}else{a=n[i.code];a.bestSolutionLink="/rankings/"+r.contestCode+"/bestsolution/"+i.code+","+r.user_handle}a.unscored=t.indexOf(i.code)!=-1;s.pushObject(a)});this.set("problems_status",s);if(Ember.isEmpty(this.get("country"))){this.set("country","Country not Available")}if(Ember.isEmpty(this.get("institution"))){this.set("institution","Not Available")}}});CCRanks.RankRow=Ember.Object.extend({problems:null,fillProperties:function(){var e=this.problems;var t=this.problems_status;var n;for(n=0;n<e.length;n++){if(!Ember.isEmpty(t[e[n].code])){this.set([e[n].code],t[e[n].code].score+"-"+(t[e[n].code].time?t[e[n].code].time:0)+"-"+(t[e[n].code].penalty?t[e[n].code].penalty:0))}else{this.set([e[n].code],"-")}}delete this.problems;delete this.problems_status;delete this.type}});CCRanks.Set=DS.Model.extend({set_name:DS.attr("string"),description:DS.attr("string"),members:DS.hasMany("member"),membersCount:function(){return this.get("members.length")}.property("members.length")});CCRanks.Member=DS.Model.extend({member_uid:DS.attr("number"),set_id:DS.belongsTo("set"),member_name:DS.attr("string"),long_contest_rating:DS.attr("number"),short_contest_rating:DS.attr("number"),country_code:DS.attr("string"),profile_link:function(){return"https://www.codechef.com/users/"+this.get("member_name")}.property("member_name"),flag_url:function(){var e=this.get("country_code");return"https://cdn.codechef.com/download/flags/24/"+e+".png"}.property("country_code")});CCRanks.MemberAdapter=DS.RESTAdapter.extend({namespace:"api/sets"});CCRanks.SetAdapter=DS.RESTAdapter.extend({namespace:"api"});function n(e){Bootstrap.GNM.push("Info!",e,"info")}function s(e){Bootstrap.GNM.push("Success!",e,"success")}function r(e){Bootstrap.GNM.push("Warning!",e,"warning")}function i(e){Bootstrap.GNM.push("Error!",e,"danger")}function a(e,t){return Math.floor(Math.random()*(t-e+1))+e}function o(t,n,s,r,i){var a=i;var o=a.get("cacheMap");if(!o.has(t)||(Date.now()-o.get(t))/1e3>=CCRanks.refreshTime){var c=function(e){var t=e;var n=t.list;var s=[];for(var i=0;i<n.length;i++){n[i].problems=t.problems;s[i]=CCRanks.RankRow.create(n[i]);s[i].fillProperties();s[i]=JSON.parse(JSON.stringify(s[i]))}var c=s[s.length-1];var u=[];$.each(c,function(e){e=e.replace("_"," ");u.push('"'+e.charAt(0).toUpperCase()+e.slice(1)+'"')});u=u.join(",");var l=document.getElementById("download");var m="data:application/csv;charset=utf-8,"+encodeURIComponent(u+"\r\n"+a.convertToCSV(s));fetch(m).then(function(e){return e.blob()}).then(function(e){l.href=URL.createObjectURL(e);l.download=a.get("contest_code")+r+"-ranklist.csv";l.click();o.set("downloaded",Date.now())})};var u=function(e){$.growl({title:"Error",message:"Failed to download ranklist, please contact devs if problem persists."})};var l={type:"POST",url:n+a.get("contest_code"),success:c,error:u};e(l,false,true)}else{var m=document.getElementById(s);m.click()}}Ember.Handlebars.helper("order",function(e){return e._parentView.contentIndex+(e.table.page-1)*e.table.itemsPerPage+1})})();