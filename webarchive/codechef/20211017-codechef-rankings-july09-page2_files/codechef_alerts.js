const LAST_ALERT_ACK_ID_KEY="lastAlertAckId";const styles={maskStyle:{top:0,left:0,position:"fixed",display:"grid",placeItems:"center",height:"100vh",width:"100vw",zIndex:1e4,lineHeight:1.5,fontSize:"16px",backdropFilter:"blur(2px)",background:"rgba(0, 0, 0, 0.1)",boxSizing:"border-box"},boxStyle:{background:"white",width:"500px",borderRadius:"7px",gridArea:"1 / 1 / 1 / 1",padding:"20px",boxShadow:"1px 1px 5px rgba(0, 0, 0, 0.2)",boxSizing:"border-box"},headerStyle:{fontWeight:600,fontSize:"20px",marginBottom:"15px",justifyContent:"space-between",display:"flex",alignItems:"center"},headerContentStyle:{boxSizing:"border-box"},footerStyle:{display:"flex",flexDirection:"row-reverse",marginTop:"15px",boxSizing:"border-box"},okButtonStyle:{padding:"5px 20px",color:"white",borderRadius:"5px",background:"rgb(75 144 226)",cursor:"pointer",boxSizing:"border-box"}};const generateElement=e=>{const t=document.createElement("div");if(e.class){t.className=e.class}if(e.style){Object.assign(t.style,e.style)}if(e.innerHTML){t.innerHTML=e.innerHTML}if(e.id){t.setAttribute("id",e.id)}if(e.onClick){t.addEventListener("click",e.onClick)}e.childs&&e.childs.forEach(e=>{t.appendChild(generateElement(e))});return t};function popUp(e,t){const s={style:styles.headerContentStyle,innerHTML:"IMPORTANT ANNOUNCEMENT"};const n={style:styles.headerStyle,childs:[s]};const i={innerHTML:e.message};const o={style:styles.okButtonStyle,innerHTML:"Okay",onClick:t};const l={style:styles.footerStyle,childs:[o]};const r={style:styles.boxStyle,childs:[n,i,l]};return generateElement(r)}class Mask{constructor(e){this.el=document.createElement("div");Object.assign(this.el.style,styles.maskStyle);this.el.style.display="none";e.appendChild(this.el)}show(){Object.assign(this.el.style,styles.maskStyle)}hide(){this.el.style.display="none"}}class AlertManager{constructor(e){this.alerts=[];this.showMask=false;this.mask=new Mask(e);this.lastAlertAckId=this.getLastAlertAckID();window.addEventListener("storage",this.storageHandler.bind(this))}storageHandler(){this.getLastAlertAckID()!==this.lastAlertAckId&&this.remove()}add(e){if(this.alerts.length===0){this.showMask=true}this.alerts.push(e);this.render()}remove(){if(this.alerts.length===1){this.showMask=false}this.alerts.shift();this.render()}render(){this.showMask?this.mask.show():this.mask.hide();this.mask.el.innerHTML="";this.alerts.forEach((e,t)=>{const s=popUp(e,t=>{this.setLastAlertAckID(e.id);this.remove()});s.style.position="relative";s.style.bottom=`${t*10}px`;s.style.left=`${t*10}px`;s.style.zIndex=`${(this.alerts.length-t)*1e5}`;this.mask.el.appendChild(s)})}getLastAlertAckID(){const e=window.localStorage.getItem(LAST_ALERT_ACK_ID_KEY);return e||this.getCookie(LAST_ALERT_ACK_ID_KEY)||-1}setLastAlertAckID(e){window.localStorage.setItem(LAST_ALERT_ACK_ID_KEY,e);this.setCookie(LAST_ALERT_ACK_ID_KEY,e,30);this.lastAlertAckId=e}setCookie(e,t,s){let n="";if(s){const e=new Date;e.setTime(e.getTime()+s*24*60*60*1e3);n="; expires="+e.toUTCString()}document.cookie=e+"="+(t||"")+n+"; path=/"}getCookie(e){const t=e+"=";const s=document.cookie.split(";");let n=null;s.forEach(e=>{e=e.trim();if(e.indexOf(t)===0){n=e.substring(t.length,e.length)}});return n}}function main(){const e=document.querySelector("body");const t=new AlertManager(e);let s=10;const n=()=>{const e=window.location.protocol==="https:"?"wss:":"ws:";const i=new WebSocket(`${e}//${window.location.hostname}/ws/sub/alerts-all`);i.addEventListener("open",()=>{fetch("/api/alerts/recent?lastAckID="+t.getLastAlertAckID()).then(e=>e.json()).then(e=>{e.alerts.forEach(e=>{t.add(e)})})});i.addEventListener("message",e=>{const s=JSON.parse(e.data);t.add(s)});i.addEventListener("close",()=>{s-- >0&&setTimeout(n,6e4)})};n()}document.readyState==="complete"?main():document.addEventListener("DOMContentLoaded",main);